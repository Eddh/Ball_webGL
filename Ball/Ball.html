<!DOCTYPE html>

<html>

    <head>

        <meta charset="utf-8" />
        <title>WebGL 3D Ball</title>
        
        <script type="text/javascript" src="glMatrix.js"></script>
        <script type="text/javascript" src="webgl-utils.js"></script>
        <script type="text/javascript" src="helpers.js"></script>
        <script type="text/javascript" src="shaderFunctions.js"></script>
        <script type="text/javascript" src="Ball.js"></script>
        
        <script id="shader-fs" type="x-shader/x-fragment">
           precision mediump float;
           
           uniform vec3 uLightDir;
           uniform vec3 uViewPos;

           varying vec4 vColor;
           varying vec3 vNormal;
           varying vec3 vFragPos;
           varying vec3 vPosOnSphere;

           void main(void) {
                float specularStrength = 0.2;
                vec3 ambient = vec3(0.2, 0.2, 0.1);
                vec3 normal = normalize(vNormal);
                
                vec3 viewDir = normalize(uViewPos - vFragPos);
                vec3 reflectDir = reflect(-uLightDir, normal); 
                
                
                float diff = max(dot(normal, normalize(uLightDir)), 0.0);
                vec3 diffuse = vec3(diff, diff, diff);
                float spec = pow(max(dot(viewDir, reflectDir), 0.0), 4.0);
                vec3 specular = specularStrength * spec * vec3(1.0, 1.0, 1.0); 
                
                vec3 color = vColor.xyz;
                if(vPosOnSphere.y < 0.5 && vPosOnSphere.y > 0.45 || vPosOnSphere.y < -0.45 && vPosOnSphere.y > -0.5 ||  vPosOnSphere.x < 0.025 && vPosOnSphere.x > -0.025){
                color = 0.3*color;
                }
                //if(length(vPosOnSphere) < 1.1 && length(vPosOnSphere) > 0.99){
                color = 0.1 + sqrt(15.0*(1.0-length(vPosOnSphere)))*color;
                //}
                color = (ambient + diffuse + specular)*color;
                gl_FragColor = vec4(color, 1.0);
           }
        </script>

        <script id="shader-vs" type="x-shader/x-vertex">
            attribute vec3 aVertexPosition;
            attribute vec4 aVertexColor;

            uniform mat4 uModel;
            uniform mat4 uView;
            uniform mat4 uPMatrix;
            uniform mat3 uNMatrix;

            varying vec4 vColor;
            varying vec3 vNormal;
            varying vec3 vPosOnSphere;
            varying vec3 vFragPos;

            void main(void) {
                vNormal = uNMatrix*normalize(aVertexPosition);
                //vNormal = aVertexPosition;
                float height = uModel[3][1];
                float posY = aVertexPosition.y;
                if(height < 1.0 && posY < 0.0){
                    posY = aVertexPosition.y*height;
                }
                vec3 vPos = vec3(aVertexPosition.x, posY, aVertexPosition.z);
                gl_Position = uPMatrix * uView * uModel * vec4(vPos, 1.0);
                vColor = aVertexColor;
                vFragPos = vec3(uModel * vec4(aVertexPosition, 1.0));
                vPosOnSphere = aVertexPosition;
            }
        </script>
    </head>


    <body onload="start();">

        <div id  = "webGLcanvas">
            <canvas id="canvas" style="border: none;" width="800" height="600"></canvas>
        </div>
        <div id  = "text">
        </div>

    </body>

</html>